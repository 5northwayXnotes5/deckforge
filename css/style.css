/* --- SYSTEM VARIABLES --- */
:root {
  --bg-os: #000;
  --app-bg: #000;
  --panel-bg: #161618;
  --dock-bg: rgba(20, 20, 20, 0.4);
  --text-primary: #fff;
  --text-sec: #8e8e93;
  --separator: #2c2c2e;
  
  /* Core Accents */
  --accent-blue: #0A84FF;
  --accent-green: #30D158;
  --accent-red: #FF453A;
  --accent-orange: #FF9F0A;
  --accent-purple: #BF5AF2;
  --accent-gold: #FFD60A;
  --accent-cyan: #64D2FF;
  --accent-pink: #FF375F;
  
  --icon-size: 60px;
  --icon-radius: 14px;
  
  --font-sys: "SF Pro Display", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
  --glass: blur(20px) saturate(180%);
}

/* --- RESET & BASE --- */
* { box-sizing: border-box; -webkit-tap-highlight-color: transparent; user-select: none; }
html, body { height: 100%; width: 100%; overflow: hidden; margin: 0; background: var(--bg-os); font-family: var(--font-sys); color: var(--text-primary); }

/* --- WALLPAPER --- */
#wallpaper {
  position: absolute; inset: -20px; z-index: 1;
  background: radial-gradient(circle at 50% 30%, #1a1f35, #000);
  background-size: cover; background-position: center;
  transition: transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1), filter 0.4s;
}
body.app-open #wallpaper { transform: scale(1.1); filter: blur(20px) brightness(0.4); }

/* --- STATUS BAR --- */
#status-bar {
  position: absolute; top: 0; left: 0; right: 0; height: 44px; z-index: 100;
  display: flex; justify-content: space-between; align-items: center;
  padding: 0 20px; font-size: 14px; font-weight: 600;
  color: white; pointer-events: none; text-shadow: 0 1px 4px rgba(0,0,0,0.5);
}
.currency-pill {
  background: rgba(0,0,0,0.3); backdrop-filter: blur(10px);
  padding: 4px 10px; border-radius: 12px;
  display: flex; align-items: center; gap: 6px;
  font-size: 12px; border: 1px solid rgba(255,255,255,0.05);
}

/* --- APP ICONS (HOME) --- */
.app-grid {
  display: grid; grid-template-columns: repeat(4, 1fr); 
  gap: 20px 12px; padding: 20px 20px; margin-top: 50px; z-index: 10; position: relative;
  transition: opacity 0.3s, transform 0.3s;
}
body.app-open .app-grid { opacity: 0; pointer-events: none; transform: scale(1.1); }

.app-item { display: flex; flex-direction: column; align-items: center; gap: 6px; cursor: pointer; transition: transform 0.1s; }
.app-item:active { transform: scale(0.95); opacity: 0.8; }

.icon-box {
  width: var(--icon-size); height: var(--icon-size);
  border-radius: var(--icon-radius);
  display: flex; align-items: center; justify-content: center;
  font-size: 28px; color: white;
  box-shadow: 0 4px 10px rgba(0,0,0,0.4);
  position: relative; overflow: hidden;
  background: #222;
}
.icon-box::after { content:''; position: absolute; inset: 0; background: rgba(0,0,0,0.15); }
.icon-box i { z-index: 2; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3)); }
.app-name { font-size: 11px; font-weight: 500; color: #ddd; text-shadow: 0 1px 2px rgba(0,0,0,0.8); }

/* --- APP GRADIENTS (Original + New) --- */
.grad-duel { background: linear-gradient(135deg, #b92b27, #1565C0); }
.grad-royale { background: linear-gradient(135deg, #4b134f, #c94b4b); }
.grad-casino { background: linear-gradient(135deg, #16a085, #f4d03f); }
.grad-mem { background: linear-gradient(135deg, #e65c00, #F9D423); }
.grad-press { background: linear-gradient(135deg, #232526, #414345); border: 1px solid rgba(255,255,255,0.1); }
.grad-cards { background: linear-gradient(135deg, #1CB5E0, #000046); }
.grad-lab { background: linear-gradient(135deg, #56ab2f, #a8e063); }
.grad-store { background: linear-gradient(135deg, #8E2DE2, #4A00E0); }
.grad-set { background: linear-gradient(135deg, #304352, #d7d2cc); }

/* New App Gradients */
.grad-bank { background: linear-gradient(135deg, #2193b0, #6dd5ed); }
.grad-saga { background: linear-gradient(135deg, #3a1c71, #d76d77, #ffaf7b); }
.grad-oracle { background: linear-gradient(135deg, #833ab4, #fd1d1d, #fcb045); }
.grad-market { background: linear-gradient(135deg, #11998e, #38ef7d); }
.grad-museum { background: linear-gradient(135deg, #DA4453, #89216B); }
.grad-term { background: #000; border: 1px solid #33ff33; color: #33ff33 !important; }
.grad-id { background: linear-gradient(135deg, #C6FFDD, #FBD786, #f7797d); }

/* --- DOCK --- */
.dock-container {
  position: absolute; bottom: 24px; left: 16px; right: 16px;
  height: 84px; z-index: 10;
  background: var(--dock-bg);
  backdrop-filter: var(--glass); -webkit-backdrop-filter: var(--glass);
  border-radius: 28px;
  display: flex; align-items: center; justify-content: space-evenly;
  border: 1px solid rgba(255,255,255,0.05);
  transition: transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);
  box-shadow: 0 10px 20px rgba(0,0,0,0.2);
}
body.app-open .dock-container { transform: translateY(200%); }

/* --- APP WINDOW --- */
.app-window {
  position: absolute; inset: 0; background: var(--app-bg);
  display: none; flex-direction: column;
  opacity: 0; transform: scale(0.95);
  transition: opacity 0.3s, transform 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
  pointer-events: auto; z-index: 50;
}
.app-window.active { display: flex; opacity: 1; transform: scale(1); }

.nav-bar {
  height: 94px;
  padding: 44px 16px 10px; 
  display: flex; align-items: flex-end; justify-content: space-between;
  background: rgba(22,22,24,0.9); backdrop-filter: blur(20px);
  border-bottom: 1px solid var(--separator); flex-shrink: 0;
}
.nav-title { font-size: 22px; font-weight: 700; color: white; line-height: 1; text-transform: uppercase; letter-spacing: 0.5px; }
.nav-gold { font-size: 14px; font-weight: 600; color: var(--accent-gold); display: flex; align-items: center; gap: 4px; background: rgba(255, 214, 10, 0.1); padding: 4px 8px; border-radius: 8px; margin-bottom: 2px; }

.content { flex: 1; overflow-y: auto; overflow-x: hidden; padding-bottom: 40px; }

/* --- GENERIC UI ELEMENTS --- */
.list-group { margin: 16px; background: var(--panel-bg); border-radius: 10px; overflow: hidden; }
.list-row {
  display: flex; justify-content: space-between; align-items: center;
  padding: 12px 16px; border-bottom: 0.5px solid var(--separator);
  font-size: 15px; color: white; min-height: 44px;
}
.list-row:last-child { border-bottom: none; }
.list-row label { font-weight: 500; color: #ddd; flex-shrink: 0; }
.list-sub { font-size: 12px; color: var(--text-sec); margin-top: 2px; }

select, input, textarea { 
  background: transparent; border: none; color: var(--accent-blue); 
  font-size: 15px; text-align: right; width: 60%; 
  font-family: inherit; height: 100%; display: block;
}
select:focus, input:focus, textarea:focus { outline: none; }

.btn {
  background: var(--panel-bg); color: var(--accent-blue);
  font-size: 16px; font-weight: 600; padding: 12px;
  border-radius: 10px; margin: 8px 16px; text-align: center; cursor: pointer;
  transition: 0.1s; border: 1px solid rgba(255,255,255,0.05);
}
.btn:active { background: #2c2c2e; transform: scale(0.98); }
.btn.filled { background: var(--accent-blue); color: white; border:none; box-shadow: 0 2px 8px rgba(10, 132, 255, 0.2); }
.btn.gold { background: var(--accent-gold); color: black; border:none; box-shadow: 0 2px 8px rgba(255, 214, 10, 0.2); }
.btn.danger { color: var(--accent-red); }
.btn.sm { padding: 6px 12px; font-size: 13px; margin: 0; width: auto; display: inline-block; }
.btn-row { display: flex; gap: 8px; margin: 16px; }
.btn-row .btn { margin: 0; flex: 1; font-size: 14px; padding: 10px; }

/* --- GAME & APP SPECIFIC STYLES --- */

/* FUSION REACTOR (Lab) */
.reactor-stage { padding: 20px 16px; display: flex; justify-content: space-between; align-items: center; }
.reactor-slot { width: 80px; height: 120px; background: rgba(0,0,0,0.3); border: 2px dashed #444; border-radius: 10px; overflow: hidden; display: flex; align-items: center; justify-content: center; position: relative; }
.reactor-slot img { width: 100%; height: 100%; object-fit: cover; }
.reactor-info { flex: 1; text-align: center; padding: 0 10px; }
.fuse-rate { font-size: 24px; font-weight: 800; color: var(--accent-green); }
.fuse-cost { font-size: 12px; color: var(--accent-gold); margin-top: 4px; }

/* SHOP */
.shop-grid { display: grid; grid-template-columns: 1fr; gap: 12px; padding: 16px; }
.shop-item {
  background: var(--panel-bg); border-radius: 14px; padding: 12px;
  display: flex; align-items: center; gap: 16px; cursor: pointer;
  border: 1px solid rgba(255,255,255,0.05);
}
.pack-icon {
  width: 50px; height: 70px; border-radius: 6px;
  display: flex; align-items: center; justify-content: center;
  font-size: 20px; color: rgba(255,255,255,0.9);
  box-shadow: 0 2px 8px rgba(0,0,0,0.3);
  position: relative;
}
/* Shop Gradients */
.p-basic { background: linear-gradient(135deg, #7f8c8d, #bdc3c7); }
.p-adv { background: linear-gradient(135deg, #16a085, #2ecc71); }
.p-elite { background: linear-gradient(135deg, #2980b9, #3498db); border: 1px solid #3498db; }
.p-comm { background: linear-gradient(135deg, #8e44ad, #9b59b6); border: 1px solid #9b59b6; }
.p-supr { background: linear-gradient(135deg, #e67e22, #f39c12); box-shadow: 0 0 10px rgba(243, 156, 18, 0.3); }
.p-myth { background: linear-gradient(135deg, #c0392b, #e74c3c); border: 1px solid #e74c3c; }
.p-god { background: linear-gradient(135deg, #000, #434343); border: 1px solid #FFD60A; box-shadow: 0 0 15px rgba(255, 214, 10, 0.4); color: #FFD60A; }

/* CASINO */
.casino-menu { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; padding: 16px; }
.casino-game { 
  background: var(--panel-bg); height: 120px; border-radius: 16px;
  display: flex; flex-direction: column; align-items: center; justify-content: center;
  gap: 10px; cursor: pointer; border: 1px solid rgba(255,255,255,0.05);
}
.casino-game i { font-size: 40px; color: var(--accent-gold); }
.casino-stage { padding: 20px; text-align: center; }
.slot-machine {
  display: flex; gap: 10px; justify-content: center; margin: 20px 0;
  background: #111; padding: 15px; border-radius: 12px; border: 2px solid #333;
}
.reel {
  width: 70px; height: 100px; background: #222; border-radius: 6px; overflow: hidden;
  display: flex; align-items: center; justify-content: center; border: 1px solid #444;
}
.reel img { width: 100%; height: 100%; object-fit: cover; }

/* DUEL & ROYALE */
.game-stage {
  margin: 16px; padding: 20px;
  background: var(--panel-bg); border-radius: 16px;
  display: flex; flex-direction: column; align-items: center;
}
.duel-slots { display: flex; gap: 20px; margin: 20px 0; }
.card-slot { width: 90px; height: 130px; background: rgba(0,0,0,0.3); border: 2px dashed #444; border-radius: 10px; overflow: hidden; display: flex; align-items: center; justify-content: center; }
.card-strip { display: flex; overflow-x: auto; gap: 12px; padding: 0 16px 20px; }
.strip-card { width: 60px; height: 90px; border-radius: 6px; flex-shrink: 0; background: #333; overflow: hidden; position: relative; }
.royale-bet-ui { padding: 20px; text-align: center; }
.royale-winner { 
  margin-top: 20px; padding: 20px; background: rgba(48, 209, 88, 0.1); 
  border-radius: 12px; border: 1px solid var(--accent-green); display: none; 
}

/* NEW: BANK */
.bank-vault { background: radial-gradient(circle, #333, #000); border-radius: 20px; padding: 20px; margin: 16px; text-align: center; border: 1px solid #444; }
.bank-display { font-size: 32px; font-weight: 700; color: var(--accent-cyan); margin: 10px 0; }
.rate-pill { font-size: 12px; background: rgba(100, 210, 255, 0.2); color: var(--accent-cyan); padding: 4px 8px; border-radius: 8px; display: inline-block; }

/* NEW: SAGA */
.saga-map { display: flex; flex-direction: column; gap: 20px; padding: 20px; position: relative; }
.saga-node { background: var(--panel-bg); padding: 16px; border-radius: 12px; border-left: 4px solid var(--separator); cursor: pointer; }
.saga-node.completed { border-left-color: var(--accent-green); opacity: 0.6; }
.saga-node.locked { opacity: 0.4; pointer-events: none; }
.saga-node.active { border-left-color: var(--accent-orange); background: #222; }

/* NEW: TERMINAL */
.term-window { background: #111; border: 1px solid #333; border-radius: 8px; margin: 16px; padding: 12px; font-family: monospace; min-height: 300px; display: flex; flex-direction: column; }
.term-out { flex: 1; color: #33ff33; font-size: 12px; white-space: pre-wrap; overflow-y: auto; margin-bottom: 10px; }
.term-in { background: transparent; border: none; border-top: 1px solid #333; color: white; width: 100%; padding: 10px 0; font-family: monospace; }

/* NEW: ORACLE */
.tarot-table { display: flex; align-items: center; justify-content: center; min-height: 300px; perspective: 1000px; }
.tarot-card { width: 140px; height: 220px; background: #222; border: 2px solid var(--accent-purple); border-radius: 12px; display: flex; align-items: center; justify-content: center; transition: transform 0.6s; transform-style: preserve-3d; position: relative; cursor: pointer; }
.tarot-card.flip { transform: rotateY(180deg); }
.tarot-face { position: absolute; inset: 0; backface-visibility: hidden; display: flex; flex-direction: column; align-items: center; justify-content: center; background: #111; border-radius: 10px; }
.tarot-back { position: absolute; inset: 0; backface-visibility: hidden; background: linear-gradient(45deg, #4b134f, #222); border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 30px; }

/* --- OVERLAYS --- */
#home-bar {
  position: fixed; bottom: 0; left: 0; right: 0; height: 24px; z-index: 9999;
  display: flex; justify-content: center; align-items: center; cursor: pointer;
}
.bar-pill { width: 120px; height: 4px; background: white; border-radius: 2px; opacity: 0.5; }

/* Modals */
.modal {
  position: fixed; inset: 0; z-index: 200; background: rgba(0,0,0,0.8); backdrop-filter: blur(10px);
  display: none; align-items: center; justify-content: center; flex-direction: column;
}
.modal.active { display: flex; }

.ios-confirm {
  width: 270px; background: rgba(30,30,30,0.9); backdrop-filter: blur(20px);
  border-radius: 14px; text-align: center; overflow: hidden;
}
.ios-confirm h3 { margin: 20px 0 5px; font-size: 17px; }
.ios-confirm p { margin: 0 20px 20px; font-size: 13px; color: #aaa; }
.ios-btns { display: flex; border-top: 0.5px solid #555; }
.ios-btn { flex: 1; padding: 12px; font-size: 17px; color: #0A84FF; cursor: pointer; border-right: 0.5px solid #555; }
.ios-btn:last-child { border: none; font-weight: 600; }
.ios-btn.destruct { color: #FF453A; }

.pack-open-anim { width: 200px; height: 280px; border-radius: 16px; background: white; display: flex; align-items: center; justify-content: center; font-size: 32px; font-weight: 900; color: #000; box-shadow: 0 0 80px rgba(255,255,255,0.2); animation: shake 0.5s ease-in-out infinite; cursor: pointer; }
@keyframes shake{ 0%,100%{transform:rotate(0);} 25%{transform:rotate(3deg);} 75%{transform:rotate(-3deg);} }

.pack-grid { 
  display: grid; grid-template-columns: repeat(3, 1fr); 
  gap: 15px; width: 100%; max-width: 320px; margin-top: 20px; 
}
.pack-grid .card-thumb {
  aspect-ratio: 2/3; background: #222; border-radius: 8px; position: relative; overflow: hidden; border: 1px solid rgba(255,255,255,0.1);
}

.card-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; padding: 16px; }
.card-thumb { aspect-ratio: 2/3; background: #222; border-radius: 8px; position: relative; overflow: hidden; border: 1px solid rgba(255,255,255,0.1); }
.card-thumb img { width: 100%; height: 100%; object-fit: cover; }
.rarity-tag { position: absolute; bottom: 0; left: 0; right: 0; height: 4px; }

/* Sheet Modal */
#sheet-modal { background: rgba(0,0,0,0.8); backdrop-filter: blur(5px); justify-content: flex-end; align-items: stretch; }
.sheet-content { background: #1c1c1e; border-radius: 20px 20px 0 0; padding: 24px; animation: slideUp 0.3s; display: flex; flex-direction: column; gap: 8px; }
@keyframes slideUp{from{transform:translateY(100%)}to{transform:translateY(0)}}

/* Toast */
.toast {
  position: fixed; top: -80px; left: 50%; transform: translateX(-50%); width: auto; min-width: 200px;
  background: rgba(40, 40, 40, 0.95); backdrop-filter: blur(20px);
  border-radius: 25px; z-index: 500; display: flex; align-items: center; justify-content: center; padding: 12px 24px; gap: 8px;
  box-shadow: 0 10px 30px rgba(0,0,0,0.5); transition: top 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
  font-size: 14px; font-weight: 500;
}
.toast.show { top: 60px; }
.toast i { color: var(--accent-gold); }

.hidden { display: none !important; }

/* --- GM MODE VISIBILITY --- */
body.gm-mode #app-item-studio {
    display: flex !important;
    animation: slideUp 0.5s ease;
}
